# 回归检查索引 (Regressions Registry)

> 记录所有回归检查，确保已修复的问题不会再次发生。

---

## 索引表

### 🖥️ 桌面应用 (Tauri/Electron/Swift)
| ID | 关联问题 | 名称 | 类型 |
|----|----------|------|------|
| R-2024-002 | P-2024-002 | WindowSwitcher 上下箭头切换窗口置顶 | 手工检查 |
| R-2024-003 | P-2024-003 | GUI 标题栏显示完整路径 | 手工检查 |
| R-2024-022 | P-2024-022 | iterate.app 更新后工具同步 | 脚本检查 |
| R-2024-052 | P-2024-052 | Shift+Tab 恢复窗口置顶顺序 | 手工检查 |
| R-2024-053 | P-2024-053 | 中文输入候选栏位置 | 手工检查 |
| R-2024-464 | P-2024-464 | update.sh osascript 密码对话框 | 手工检查 |
| R-2025-001 | P-2025-001 | Windsurf 插入功能验证 | 手工检查 |
| R-2025-002 | P-2025-002 | macOS 全屏显示兼容性验证 | 手工检查 |
| R-2025-003 | P-2025-003 | 无边框窗口拖拽与位置记忆 | 手工检查 |
| R-2025-004 | P-2025-004 | 打包应用权限与自动化回归 | 手工检查 |
| R-2025-005 | P-2025-005 | 全局快捷键开关与系统快捷键冲突验证 | 手工检查 |
| R-2026-005 | P-2026-005 | macOS Swift 全局热键 Option+Q | 手工检查 |

### 🔧 知识库与流程
| ID | 关联问题 | 名称 | 类型 |
|----|----------|------|------|
| R-2024-001 | P-2024-001 | 全局知识库流程验证 | 流程验证 |
| R-2026-001 | P-2026-001 | .gitignore 保护与自动检测验证 | 流程验证 |

### 🌐 Web/SaaS
| ID | 关联问题 | 名称 | 类型 |
|----|----------|------|------|
| R-2024-005 | P-2024-005 | Supabase RLS anon 角色权限 | 手工检查 |
| R-2024-051 | P-2024-051 | AI-Sidebar NotebookLM 标题捕获 | 手工检查 |

---

## 条目格式说明

每个回归检查应包含：
- **ID**: R-YYYY-NNN 格式
- **关联问题**: P-ID
- **类型**: unit / e2e / integration / 手工检查 / 脚本检查 / CI 验证 / 部署验证 / 流程验证
- **位置**: 测试文件路径（手工检查类填 N/A）
- **关键断言**: 检查的核心逻辑
- **运行方式**: 执行命令

---

## R-2026-001 .gitignore 保护与自动检测验证

- **类型**：流程/逻辑验证
- **描述**：验证系统能否识别并预防项目级忽略规则对知识库的干扰。
- **检查步骤**：
  1. 故意在 `.gitignore` 中删除 `!.cunzhi-knowledge/` 规则，并确保存在 `*.md`。
  2. 调用 `ji(action="回忆")`。
  3. **预期结果**：输出中应包含 "⚠️ 配置风险检测" 警告，并显示修复命令。
  4. 执行修复命令。
  5. 再次调用 `ji(action="回忆")`，警告应消失。
  6. 检查 IDE 资源管理器，`.cunzhi-knowledge/` 内的文件应正常显示。
- **关联 P-ID**：P-2026-001
- **验证版本**：v0.5.0
- **日期**：2026-01-03

---

## R-2025-004 打包应用权限与自动化回归检查

- ID: R-2025-004
- 关联问题: P-2025-004
- 类型: 手工检查
- 位置: /Users/apple/提示词最新的/Full-screen-prompt/package.json, entitlements.mac.plist
- 关键断言: 
  1. 应用打包后，第一次执行插入操作时应弹出“Apple Events/自动化”授权请求。
  2. 授权后，Console 不应再出现 -1743 错误。
  3. 通过 Dock 右键退出应用后，`ps aux | grep Prompter` 应无残留进程。
- 运行方式: 
  1. 运行 `bash install-prompt.sh` 打包并安装。
  2. 在系统设置中重置辅助功能和自动化权限。
  3. 打开 Prompter 并执行插入，确保弹出并允许自动化权限。
  4. 验证插入成功且应用能彻底退出。

## R-2025-003 无边框窗口拖拽与位置记忆回归检查

- ID: R-2025-003
- 关联问题: P-2025-003
- 类型: 手工检查
- 位置: /Users/apple/提示词最新的/Full-screen-prompt/app.html, /Users/apple/提示词最新的/Full-screen-prompt/main.js
- 关键断言: 
  1. 窗口背景和顶部 32px 区域支持点击拖动。
  2. 搜索框、按钮、列表项点击功能正常（-webkit-app-region: no-drag 生效）。
  3. 拖动窗口并关闭后，再次打开窗口位置保持不变。
- 运行方式: 
  1. 启动应用。
  2. 拖动窗口位置。
  3. 使用快捷键隐藏并重新呼出，观察位置是否记忆。
  4. 测试搜索框输入和按钮点击。

## R-2025-002 macOS 全屏显示兼容性验证

- ID: R-2025-002
- 关联问题: P-2025-002
- 类型: 手工检查
- 位置: N/A (跨框架对比)
- 关键断言: 
  1. 在 macOS 全屏应用（如 Chrome 全屏）下，Electron 版 Prompt.app 必须能正常覆盖在最前方。
  2. Tauri 版本在全屏模式下虽能盲打但不可见，验证了框架级限制。
- 运行方式: 
  1. 运行 `/Applications/Prompt.app`。
  2. 将当前 browser 全屏。
  3. 按 `Shift+Cmd+P`，检查窗口是否浮现在浏览器之上。

## R-2025-001 Windsurf 插入功能回归检查

- ID: R-2025-001
- 关联问题: P-2025-001
- 类型: 手工检查
- 位置: /Users/apple/提示词最新的/Full-screen-prompt/main.js
- 关键断言: 检查 `lastFrontAppPid` 是否成功捕获非 0 的 PID，且 `activateAppByPid` 执行无报错。
- 运行方式: 
  1. 打开 Windsurf
  2. Shift+Cmd+P 呼出 Prompt
  3. 选择插入，检查 Windsurf 是否被激活并完成粘贴。

