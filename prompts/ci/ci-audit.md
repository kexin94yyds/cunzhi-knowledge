# /ci:audit

**模板分类**: Action
**提示级别**: 2 (Parameterized)

审计 CI 工作流健康状况并生成改进建议。

## 指令

1. 获取所有工作流定义
   ```bash
   ls -la .github/workflows/
   ```

2. 分析每个工作流的：
   - 触发条件（push, pull_request, schedule 等）
   - 作业结构和依赖
   - 步骤复杂度
   - 缓存使用
   - 密钥管理

3. 获取最近运行统计
   ```bash
   gh run list --limit 50 --json status,conclusion,workflowName
   ```

4. 识别问题模式：
   - 高失败率工作流
   - 运行时间异常
   - 频繁取消
   - 资源浪费

## 审计清单

### 工作流配置
- [ ] 触发条件适当
- [ ] 路径过滤正确
- [ ] 并发控制配置
- [ ] 超时设置合理

### 作业优化
- [ ] 并行作业最大化
- [ ] 依赖缓存使用
- [ ] 制品大小合理
- [ ] 矩阵策略适当

### 安全
- [ ] 密钥最小权限
- [ ] 无硬编码凭据
- [ ] 依赖锁定
- [ ] 第三方 Action 固定版本

### 可维护性
- [ ] 重复逻辑抽取
- [ ] 清晰的作业命名
- [ ] 适当的注释
- [ ] 错误处理完善

## 报告格式

### 摘要
- 总工作流数
- 健康工作流数
- 需关注工作流数

### 工作流详情
对每个工作流：
- 名称和路径
- 最近 10 次运行成功率
- 平均运行时间
- 识别的问题
- 改进建议

### 优先建议
1. [高优先级] [问题描述] → [解决方案]
2. [中优先级] [问题描述] → [解决方案]
3. [低优先级] [问题描述] → [解决方案]

### 后续行动
- 立即修复项
- 计划改进项
- 监控项
