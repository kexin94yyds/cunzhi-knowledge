# 测试指南

**模板分类**: Message-Only
**提示级别**: 4 (Contextual)

测试哲学、原则和命令。

## 测试哲学

**推荐使用真实服务测试而非 Mock。** 所有测试使用真实数据库连接而非 mock，以保证生产一致性。

### 为什么不用 Mock？

- **生产一致性**: 测试针对真实数据库运行
- **捕获集成 bug**: 真实数据库交互暴露 mock 隐藏的问题
- **信心**: 测试通过意味着代码与真实服务一起工作
- **无 mock 漂移**: 测试永远不会与实际数据库行为偏离

## 测试命令

```bash
bun test                          # 运行测试套件
DEBUG=1 bun test                  # 详细测试输出
bunx tsc --noEmit                 # 不生成文件的类型检查
```

## 测试环境

### 环境变量加载

测试自动通过预加载脚本加载 `.env.test`：

- 预加载脚本解析 `.env.test` 并加载到 `process.env`
- 帮助函数从 `process.env` 读取配置

**不要**在测试文件中硬编码环境变量。

### 验证

运行验证脚本检测测试中硬编码的环境变量赋值。

违规示例：
```typescript
// 错误 - 会失败验证
process.env.DATABASE_URL = "http://localhost:5432"
```

## 测试覆盖

- 单元测试：认证、速率限制、验证
- 集成测试：API 端点、数据库操作
- 回归测试：已知问题场景

## 相关文档

- 数据库 Schema
- API 集成
- 开发命令
- 日志标准
